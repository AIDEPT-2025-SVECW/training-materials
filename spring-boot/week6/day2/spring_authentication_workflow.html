<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Authentication Workflow - Deep Dive</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #333;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            padding: 40px 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2em;
        }

        .section {
            background: white;
            margin: 30px 0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .section-header:hover {
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
        }

        .section-header h2 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        .section-header .toggle {
            position: absolute;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            transition: transform 0.3s ease;
        }

        .section-content {
            padding: 30px;
            display: none;
        }

        .section-content.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .workflow-diagram {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .workflow-step {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.3);
        }

        .workflow-step:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(79, 172, 254, 0.4);
        }

        .workflow-step.active {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 8px 25px rgba(250, 112, 154, 0.4);
        }

        .workflow-step h3 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .arrow {
            text-align: center;
            font-size: 2em;
            color: #667eea;
            margin: 10px 0;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            border-left: 4px solid #4facfe;
            position: relative;
        }

        .code-block::before {
            content: 'Java';
            position: absolute;
            top: 10px;
            right: 15px;
            background: #4facfe;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .highlight {
            background: rgba(79, 172, 254, 0.2);
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: bold;
        }

        .interactive-demo {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .demo-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1em;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .demo-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .demo-output {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            min-height: 100px;
            border: 2px dashed #ddd;
            font-family: monospace;
            text-align: left;
        }

        .key-concepts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .concept-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .concept-card:hover {
            transform: translateY(-5px);
        }

        .concept-card h3 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .method-signature {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            position: relative;
        }

        .method-signature::before {
            content: 'Method Signature';
            position: absolute;
            top: -10px;
            left: 15px;
            background: white;
            padding: 0 10px;
            font-size: 12px;
            color: #667eea;
            font-weight: bold;
        }

        .flow-animation {
            position: relative;
            height: 200px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .flow-item {
            position: absolute;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            transition: all 0.5s ease;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .section-content {
                padding: 20px;
            }
            
            .key-concepts {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîê Spring Authentication Workflow</h1>
            <p>Interactive Deep Dive for Engineering Students</p>
        </div>

        <!-- Overview Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üìã Authentication Workflow Overview</h2>
                <span class="toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <p>Spring Security's authentication workflow is a sophisticated process that involves multiple components working together to verify user credentials and establish security context.</p>
                
                <div class="workflow-diagram">
                    <div class="workflow-step" onclick="highlightStep(0)">
                        <h3>1. Authentication Request</h3>
                        <p>User submits credentials (username/password) through login form or API</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="workflow-step" onclick="highlightStep(1)">
                        <h3>2. AuthenticationManager</h3>
                        <p>Central coordinator that delegates authentication to appropriate providers</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="workflow-step" onclick="highlightStep(2)">
                        <h3>3. AuthenticationProvider</h3>
                        <p>Handles specific authentication mechanisms (DB, LDAP, OAuth, etc.)</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="workflow-step" onclick="highlightStep(3)">
                        <h3>4. UserDetailsService</h3>
                        <p>Loads user information from various data sources</p>
                    </div>
                    <div class="arrow">‚Üì</div>
                    
                    <div class="workflow-step" onclick="highlightStep(4)">
                        <h3>5. Authentication Result</h3>
                        <p>Returns authenticated principal or throws exception</p>
                    </div>
                </div>

                <div class="interactive-demo">
                    <h3>üéÆ Interactive Flow Simulation</h3>
                    <button class="demo-button" onclick="simulateAuthentication()">Start Authentication Flow</button>
                    <button class="demo-button" onclick="resetSimulation()">Reset</button>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="demo-output" id="demoOutput">Click "Start Authentication Flow" to see the process in action...</div>
                </div>
            </div>
        </div>

        <!-- AuthenticationManager Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üéØ AuthenticationManager</h2>
                <span class="toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <p>The <span class="highlight">AuthenticationManager</span> is the main interface for authentication in Spring Security. It's responsible for coordinating the authentication process.</p>
                
                <div class="method-signature">
                    <strong>Authentication authenticate(Authentication authentication) throws AuthenticationException</strong>
                </div>

                <div class="key-concepts">
                    <div class="concept-card">
                        <h3>üîß Core Responsibility</h3>
                        <p>Acts as the central coordinator for authentication. It doesn't perform authentication itself but delegates to registered AuthenticationProviders.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>üèóÔ∏è Implementation</h3>
                        <p>Most commonly implemented by <code>ProviderManager</code>, which maintains a list of AuthenticationProviders and tries each one until success or all fail.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>‚ö° Key Features</h3>
                        <p>Supports authentication erasure, parent authentication managers, and authentication event publishing.</p>
                    </div>
                </div>

                <pre class="code-block">
@Component
public class CustomAuthenticationManager implements AuthenticationManager {
    
    @Autowired
    private List&lt;AuthenticationProvider&gt; providers;
    
    @Override
    public Authentication authenticate(Authentication authentication) 
            throws AuthenticationException {
        
        for (AuthenticationProvider provider : providers) {
            if (provider.supports(authentication.getClass())) {
                try {
                    Authentication result = provider.authenticate(authentication);
                    if (result != null) {
                        return result;
                    }
                } catch (AuthenticationException e) {
                    // Log and continue to next provider
                    lastException = e;
                }
            }
        }
        
        throw new ProviderNotFoundException("No suitable provider found");
    }
}
                </pre>

                <div class="interactive-demo">
                    <h3>üß™ AuthenticationManager Demo</h3>
                    <button class="demo-button" onclick="demonstrateAuthManager()">Test Authentication Manager</button>
                    <div class="demo-output" id="authManagerOutput"></div>
                </div>
            </div>
        </div>

        <!-- AuthenticationProvider Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üîç AuthenticationProvider</h2>
                <span class="toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <p>The <span class="highlight">AuthenticationProvider</span> interface defines the contract for authentication providers that handle specific authentication mechanisms.</p>
                
                <div class="method-signature">
                    <strong>Authentication authenticate(Authentication authentication) throws AuthenticationException</strong><br><br>
                    <strong>boolean supports(Class&lt;?&gt; authentication)</strong>
                </div>

                <div class="key-concepts">
                    <div class="concept-card">
                        <h3>üé≠ authenticate() Method</h3>
                        <p>Performs the actual authentication logic. Returns a fully authenticated Authentication object with credentials cleared, or null if the provider cannot authenticate.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>‚úÖ supports() Method</h3>
                        <p>Determines whether this provider can handle the given Authentication type. This allows for multiple providers handling different authentication mechanisms.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>üîÑ Common Implementations</h3>
                        <p>DaoAuthenticationProvider (database), LdapAuthenticationProvider (LDAP), JwtAuthenticationProvider (JWT tokens), etc.</p>
                    </div>
                </div>

                <pre class="code-block">
@Component
public class CustomDaoAuthenticationProvider implements AuthenticationProvider {
    
    @Autowired
    private UserDetailsService userDetailsService;
    
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    @Override
    public Authentication authenticate(Authentication authentication) 
            throws AuthenticationException {
        
        String username = authentication.getName();
        String password = authentication.getCredentials().toString();
        
        // Load user details
        UserDetails userDetails = userDetailsService.loadUserByUsername(username);
        
        // Verify password
        if (!passwordEncoder.matches(password, userDetails.getPassword())) {
            throw new BadCredentialsException("Invalid credentials");
        }
        
        // Create successful authentication
        return new UsernamePasswordAuthenticationToken(
            userDetails, null, userDetails.getAuthorities());
    }
    
    @Override
    public boolean supports(Class&lt;?&gt; authentication) {
        return UsernamePasswordAuthenticationToken.class.isAssignableFrom(authentication);
    }
}
                </pre>

                <div class="interactive-demo">
                    <h3>üî¨ Provider Methods Demo</h3>
                    <button class="demo-button" onclick="testSupportsMethod()">Test supports() Method</button>
                    <button class="demo-button" onclick="testAuthenticateMethod()">Test authenticate() Method</button>
                    <div class="demo-output" id="providerOutput"></div>
                </div>

                <div class="flow-animation" id="providerFlow">
                    <div class="flow-item" style="left: 20px; top: 70px;">1</div>
                    <div class="flow-item" style="left: 120px; top: 70px;">2</div>
                    <div class="flow-item" style="left: 220px; top: 70px;">3</div>
                    <div class="flow-item" style="left: 320px; top: 70px;">4</div>
                </div>
            </div>
        </div>

        <!-- UserDetailsService Section -->
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üë§ UserDetailsService</h2>
                <span class="toggle">‚ñº</span>
            </div>
            <div class="section-content">
                <p>The <span class="highlight">UserDetailsService</span> is a core interface that defines how to retrieve user information. It provides an abstraction layer over different user identity stores.</p>
                
                <div class="method-signature">
                    <strong>UserDetails loadUserByUsername(String username) throws UsernameNotFoundException</strong>
                </div>

                <div class="key-concepts">
                    <div class="concept-card">
                        <h3>üéØ Primary Purpose</h3>
                        <p>Provides a standard way to load user-specific data during authentication. It's the bridge between Spring Security and your user data source.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>üîÑ Data Source Abstraction</h3>
                        <p>Can load users from databases, LDAP, memory, web services, or any custom source. Implementation details are hidden behind this interface.</p>
                    </div>
                    
                    <div class="concept-card">
                        <h3>üìä UserDetails Contract</h3>
                        <p>Returns UserDetails object containing username, password, authorities, and account status flags (enabled, expired, locked).</p>
                    </div>
                </div>

                <pre class="code-block">
@Service
public class CustomUserDetailsService implements UserDetailsService {
    
    @Autowired
    private UserRepository userRepository;
    
    @Override
    public UserDetails loadUserByUsername(String username) 
            throws UsernameNotFoundException {
        
        // Fetch user from database
        User user = userRepository.findByUsername(username)
            .orElseThrow(() -> new UsernameNotFoundException(
                "User not found: " + username));
        
        // Convert to Spring Security UserDetails
        return org.springframework.security.core.userdetails.User.builder()
            .username(user.getUsername())
            .password(user.getPassword())
            .authorities(user.getRoles().stream()
                .map(role -> new SimpleGrantedAuthority("ROLE_" + role.getName()))
                .collect(Collectors.toList()))
            .accountExpired(!user.isAccountNonExpired())
            .accountLocked(!user.isAccountNonLocked())
            .credentialsExpired(!user.isCredentialsNonExpired())
            .disabled(!user.isEnabled())
            .build();
    }
}
                </pre>

                <div class="interactive-demo">
                    <h3>üé™ UserDetailsService Demo</h3>
                    <input type="text" id="usernameInput" placeholder="Enter username" style="padding: 10px; border-radius: 5px; border: 1px solid #ddd; margin: 10px;">
                    <button class="demo-button" onclick="loadUserDetails()">Load User Details</button>
                    <div class="demo-output" id="userDetailsOutput"></div>
                </div>

                <pre class="code-block">
// Custom UserDetails implementation
public class CustomUserDetails implements UserDetails {
    private String username;
    private String password;
    private List&lt;GrantedAuthority&gt; authorities;
    private boolean enabled;
    private boolean accountNonExpired;
    private boolean credentialsNonExpired;
    private boolean accountNonLocked;
    
    // Constructor and getters...
    
    @Override
    public Collection&lt;? extends GrantedAuthority&gt; getAuthorities() {
        return authorities;
    }
    
    @Override
    public boolean isEnabled() {
        return enabled;
    }
    
    // Other UserDetails methods...
}
                </p>
            </div>
        </div>

        <!-- Integration Example -->
         
        <div class="section">
            <div class="section-header" onclick="toggleSection(this)">
                <h2>üîó Complete Integration Example</h2>
                <span class="toggle">‚ñº</span>
            </div>
            <class class="section-content">
                <p>Here's how all components work together in a complete Spring Security configuration:</p>
                <img src="authentication-workflow.png" width="50%" height="50%" style="margin: 30px;"/>
                <p>üìå Diagram inspired by 
    <a href="https://www.javainuse.com/webseries/spring-security-jwt/chap3" target="_blank" style="color: #1e88e5; text-decoration: none;">
      JavaInUse Spring Security JWT Series (Chapter 3)
    </a></p>
                
                <pre class="code-block">
@Configuration
@EnableWebSecurity
public class SecurityConfig {
    
    @Autowired
    private CustomUserDetailsService userDetailsService;
    
    @Bean
    public AuthenticationManager authenticationManager(
            AuthenticationConfiguration config) throws Exception {
        return config.getAuthenticationManager();
    }
    
    @Bean
    public AuthenticationProvider authenticationProvider() {
        DaoAuthenticationProvider provider = new DaoAuthenticationProvider();
        provider.setUserDetailsService(userDetailsService);
        provider.setPasswordEncoder(passwordEncoder());
        return provider;
    }
    
    @Bean
    public PasswordEncoder passwordEncoder() {
        return new BCryptPasswordEncoder();
    }
    
    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/login", "/register").permitAll()
                .anyRequest().authenticated()
            )
            .formLogin(form -> form
                .loginPage("/login")
                .defaultSuccessUrl("/dashboard")
            )
            .authenticationProvider(authenticationProvider());
        
        return http.build();
    }
}
                </p>

                <div class="interactive-demo">
                    <h3>üéØ Complete Flow Demonstration</h3>
                    <button class="demo-button" onclick="demonstrateCompleteFlow()">Run Complete Authentication</button>
                    <div class="demo-output" id="completeFlowOutput"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for demonstrations
        let currentStep = 0;
        const steps = ['request', 'manager', 'provider', 'userdetails', 'result'];
        
        // Mock user database
        const mockUsers = {
            'john_doe': {
                username: 'john_doe',
                password: '$2a$10$N9qo8uLOickgx2ZMRZoMye', // 'password' encrypted
                roles: ['USER'],
                enabled: true,
                accountNonExpired: true,
                credentialsNonExpired: true,
                accountNonLocked: true
            },
            'admin': {
                username: 'admin',
                password: '$2a$10$N9qo8uLOickgx2ZMRZoMye', // 'admin123' encrypted
                roles: ['ADMIN', 'USER'],
                enabled: true,
                accountNonExpired: true,
                credentialsNonExpired: true,
                accountNonLocked: true
            }
        };

        function toggleSection(header) {
            const content = header.nextElementSibling;
            const toggle = header.querySelector('.toggle');
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                toggle.textContent = '‚ñº';
            } else {
                content.classList.add('active');
                toggle.textContent = '‚ñ≤';
            }
        }

        function highlightStep(stepIndex) {
            const steps = document.querySelectorAll('.workflow-step');
            steps.forEach((step, index) => {
                if (index === stepIndex) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }

        function simulateAuthentication() {
            const output = document.getElementById('demoOutput');
            const progressFill = document.getElementById('progressFill');
            let step = 0;
            const messages = [
                'üîë Step 1: Receiving authentication request (username: john_doe)',
                'üéØ Step 2: AuthenticationManager delegates to providers',
                'üîç Step 3: DaoAuthenticationProvider processes credentials',
                'üë§ Step 4: UserDetailsService loads user from database',
                '‚úÖ Step 5: Authentication successful! Security context established'
            ];

            output.innerHTML = '';
            progressFill.style.width = '0%';

            const interval = setInterval(() => {
                output.innerHTML += `<div style="margin: 5px 0; opacity: 0; animation: fadeIn 0.5s forwards;">${messages[step]}</div>`;
                progressFill.style.width = `${(step + 1) * 20}%`;
                highlightStep(step);
                
                step++;
                if (step >= messages.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        output.innerHTML += `<div style="margin: 15px 0; padding: 10px; background: #d4edda; border-radius: 5px; color: #155724; animation: fadeIn 0.5s forwards;"><strong>üéâ Authentication Complete!</strong><br>User authenticated successfully and security context established.</div>`;
                    }, 500);
                }
            }, 1000);
        }

        function resetSimulation() {
            document.getElementById('demoOutput').innerHTML = 'Click "Start Authentication Flow" to see the process in action...';
            document.getElementById('progressFill').style.width = '0%';
            document.querySelectorAll('.workflow-step').forEach(step => step.classList.remove('active'));
        }

        function demonstrateAuthManager() {
            const output = document.getElementById('authManagerOutput');
            output.innerHTML = `
                <div style="animation: fadeIn 0.5s forwards;">
                    <h4>üéØ AuthenticationManager Execution:</h4>
                    <p><strong>Input:</strong> UsernamePasswordAuthenticationToken(john_doe, password)</p>
                    <p><strong>Process:</strong></p>
                    <ul style="margin: 10px 0;">
                        <li>‚úì Checking DaoAuthenticationProvider.supports() = true</li>
                        <li>‚úì Delegating to DaoAuthenticationProvider.authenticate()</li>
                        <li>‚úì Provider returned successful authentication</li>
                    </ul>
                    <p><strong>Output:</strong> Authentication[principal=john_doe, authenticated=true]</p>
                </div>
            `;
        }

        function testSupportsMethod() {
            const output = document.getElementById('providerOutput');
            output.innerHTML = `
                <div style="animation: fadeIn 0.5s forwards;">
                    <h4>‚úÖ Testing supports() Method:</h4>
                    <p><strong>DaoAuthenticationProvider.supports(UsernamePasswordAuthenticationToken.class)</strong> = <span style="color: green;">true</span></p>
                    <p><strong>DaoAuthenticationProvider.supports(PreAuthenticatedAuthenticationToken.class)</strong> = <span style="color: red;">false</span></p>
                    <p><strong>JwtAuthenticationProvider.supports(JwtAuthenticationToken.class)</strong> = <span style="color: green;">true</span></p>
                    <br>
                    <div style="background: #e3f2fd; padding: 10px; border-radius: 5px;">
                        <strong>üí° Key Point:</strong> The supports() method ensures each provider only handles authentication types it's designed for.
                    </div>
                </div>
            `;
        }

        function testAuthenticateMethod() {
            const output = document.getElementById('providerOutput');
            output.innerHTML = `
                <div style="animation: fadeIn 0.5s forwards;">
                    <h4>üî¨ Testing authenticate() Method:</h4>
                    <p><strong>Input:</strong> UsernamePasswordAuthenticationToken("john_doe", "password")</p>
                    <p><strong>Process:</strong></p>
                    <ol style="margin: 10px 0;">
                        <li>üìã Extract username and password from authentication object</li>
                        <li>üë§ Call userDetailsService.loadUserByUsername("john_doe")</li>
                        <li>üîê Verify password using passwordEncoder.matches()</li>
                        <li>‚úÖ Create authenticated token with user details and authorities</li>
                    </ol>
                    <p><strong>Output:</strong> UsernamePasswordAuthenticationToken[authenticated=true, authorities=[ROLE_USER]]</p>
                    <div style="background: #f0f8ff; padding: 10px; border-radius: 5px; margin-top: 10px;">
                        <strong>üéØ Result:</strong> Fully authenticated token with cleared credentials for security
                    </div>
                </div>
            `;
        }

        function loadUserDetails() {
            const username = document.getElementById('usernameInput').value.trim();
            const output = document.getElementById('userDetailsOutput');
            
            if (!username) {
                output.innerHTML = '<div style="color: red;">Please enter a username</div>';
                return;
            }
            
            const user = mockUsers[username];
            
            if (user) {
                output.innerHTML = `
                    <div style="animation: fadeIn 0.5s forwards;">
                        <h4>üë§ UserDetails loaded successfully:</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <p><strong>Username:</strong> ${user.username}</p>
                            <p><strong>Password:</strong> ${user.password.substring(0, 20)}... (encrypted)</p>
                            <p><strong>Authorities:</strong> ${user.roles.map(role => 'ROLE_' + role).join(', ')}</p>
                            <p><strong>Enabled:</strong> ${user.enabled ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Account Non Expired:</strong> ${user.accountNonExpired ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Credentials Non Expired:</strong> ${user.credentialsNonExpired ? '‚úÖ' : '‚ùå'}</p>
                            <p><strong>Account Non Locked:</strong> ${user.accountNonLocked ? '‚úÖ' : '‚ùå'}</p>
                        </div>
                        <div style="background: #d1ecf1; padding: 10px; border-radius: 5px; color: #0c5460;">
                            <strong>üí° Note:</strong> This UserDetails object will be used by AuthenticationProvider for credential verification and authority assignment.
                        </div>
                    </div>
                `;
            } else {
                output.innerHTML = `
                    <div style="animation: fadeIn 0.5s forwards;">
                        <div style="background: #f8d7da; padding: 15px; border-radius: 8px; color: #721c24;">
                            <h4>‚ùå UsernameNotFoundException</h4>
                            <p>User '${username}' not found in the system.</p>
                            <p><strong>Available test users:</strong> john_doe, admin</p>
                        </div>
                        <div style="background: #fff3cd; padding: 10px; border-radius: 5px; color: #856404; margin-top: 10px;">
                            <strong>üîç What happens next:</strong> This exception would be caught by the AuthenticationProvider and converted to a BadCredentialsException to prevent username enumeration attacks.
                        </div>
                    </div>
                `;
            }
        }

        function demonstrateCompleteFlow() {
            const output = document.getElementById('completeFlowOutput');
            let step = 0;
            const flowSteps = [
                {
                    title: 'üåê 1. HTTP Request Received',
                    content: 'POST /login with username=john_doe, password=password',
                    detail: 'Spring Security filter chain intercepts the request'
                },
                {
                    title: 'üîê 2. Authentication Filter',
                    content: 'UsernamePasswordAuthenticationFilter creates authentication token',
                    detail: 'Creates: UsernamePasswordAuthenticationToken[principal=john_doe, credentials=password, authenticated=false]'
                },
                {
                    title: 'üéØ 3. AuthenticationManager.authenticate()',
                    content: 'ProviderManager iterates through registered providers',
                    detail: 'Finds DaoAuthenticationProvider that supports UsernamePasswordAuthenticationToken'
                },
                {
                    title: 'üîç 4. AuthenticationProvider.authenticate()',
                    content: 'DaoAuthenticationProvider processes the authentication',
                    detail: 'Calls UserDetailsService and validates credentials'
                },
                {
                    title: 'üë§ 5. UserDetailsService.loadUserByUsername()',
                    content: 'Loads user details from configured data source',
                    detail: 'Returns UserDetails with username, encrypted password, and authorities'
                },
                {
                    title: 'üîë 6. Password Verification',
                    content: 'PasswordEncoder compares provided password with stored hash',
                    detail: 'BCryptPasswordEncoder.matches(rawPassword, encodedPassword) = true'
                },
                {
                    title: '‚úÖ 7. Authentication Success',
                    content: 'Creates fully authenticated Authentication object',
                    detail: 'UsernamePasswordAuthenticationToken[authenticated=true, authorities=[ROLE_USER]]'
                },
                {
                    title: 'üè† 8. Security Context',
                    content: 'SecurityContextHolder stores the authentication',
                    detail: 'User session established, redirect to /dashboard'
                }
            ];

            output.innerHTML = '<div id="flowProgress"><h4>üöÄ Starting Complete Authentication Flow...</h4></div>';

            const interval = setInterval(() => {
                if (step < flowSteps.length) {
                    const stepData = flowSteps[step];
                    output.innerHTML += `
                        <div style="margin: 15px 0; padding: 15px; background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); border-radius: 10px; border-left: 4px solid #2196f3; animation: slideInLeft 0.5s forwards;">
                            <h5 style="margin: 0 0 8px 0; color: #1976d2;">${stepData.title}</h5>
                            <p style="margin: 0 0 5px 0; font-weight: 500;">${stepData.content}</p>
                            <small style="color: #666; font-style: italic;">${stepData.detail}</small>
                        </div>
                    `;
                    step++;
                } else {
                    clearInterval(interval);
                    setTimeout(() => {
                        output.innerHTML += `
                            <div style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #c8e6c9 0%, #dcedc8 100%); border-radius: 15px; text-align: center; animation: bounceIn 0.8s forwards;">
                                <h3 style="color: #2e7d32; margin: 0 0 10px 0;">üéâ Authentication Flow Complete!</h3>
                                <p style="margin: 0; color: #388e3c;">User successfully authenticated and logged in to the system.</p>
                                <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.7); border-radius: 8px;">
                                    <strong>Final State:</strong> SecurityContext contains authenticated user with ROLE_USER authority
                                </div>
                            </div>
                        `;
                    }, 500);
                }
            }, 800);
        }

        // Add CSS animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            
            @keyframes slideInLeft {
                from { opacity: 0; transform: translateX(-30px); }
                to { opacity: 1; transform: translateX(0); }
            }
            
            @keyframes bounceIn {
                0% { opacity: 0; transform: scale(0.3); }
                50% { opacity: 1; transform: scale(1.05); }
                70% { transform: scale(0.9); }
                100% { opacity: 1; transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-open the first section
            const firstSection = document.querySelector('.section .section-content');
            const firstToggle = document.querySelector('.section .toggle');
            if (firstSection && firstToggle) {
                firstSection.classList.add('active');
                firstToggle.textContent = '‚ñ≤';
            }
        });
    </script>
</body>
</html>