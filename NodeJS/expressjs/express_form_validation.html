<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Express.js Form Validation - Interactive Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: #f7fafc;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        
        .section h3 {
            color: #4a5568;
            margin-top: 20px;
            margin-bottom: 10px;
            font-size: 1.3em;
        }
        
        .analogy {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .analogy strong {
            color: #d97706;
            display: block;
            margin-bottom: 8px;
        }
        
        pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-size: 0.9em;
            line-height: 1.5;
        }
        
        .key-point {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .warning {
            background: #fee2e2;
            border-left: 4px solid #ef4444;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 24px;
            background: #e2e8f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: #cbd5e0;
        }
        
        .tab.active {
            background: #667eea;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .demo-box {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .code-label {
            background: #667eea;
            color: white;
            padding: 8px 15px;
            border-radius: 5px 5px 0 0;
            font-weight: bold;
            display: inline-block;
            margin-bottom: -5px;
        }
        
        ul, ol {
            margin-left: 25px;
            margin-top: 10px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        .highlight {
            background: #fef3c7;
            padding: 2px 6px;
            border-radius: 3px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Express.js Form Validation</h1>
            <p>Master the art of validating user input in Node.js applications</p>
        </header>
        
        <div class="content">
            <!-- Introduction -->
            <div class="section">
                <h2>üìö What is Form Validation?</h2>
                <p>Form validation is the process of checking user input to ensure it meets your application's requirements before processing it. It's like a security guard at the entrance of a building - checking everyone's credentials before letting them in!</p>
                
                <div class="analogy">
                    <strong>üéØ Real-World Analogy:</strong>
                    Imagine you're running a railway ticket booking counter. Before accepting a booking, you need to verify:
                    <ul>
                        <li>Is the passenger's name provided?</li>
                        <li>Is the age within valid range (not negative or impossibly high)?</li>
                        <li>Is the email format correct?</li>
                        <li>Is the phone number exactly 10 digits?</li>
                    </ul>
                    This is exactly what form validation does in web applications!
                </div>
                
                <h3>Why is Validation Important?</h3>
                <ol>
                    <li><strong>Security:</strong> Prevents malicious data from entering your database</li>
                    <li><strong>Data Integrity:</strong> Ensures your database has clean, consistent data</li>
                    <li><strong>User Experience:</strong> Provides helpful feedback to users</li>
                    <li><strong>Business Logic:</strong> Enforces your application's rules</li>
                </ol>
            </div>
            
            <!-- Validation Approaches -->
            <div class="section">
                <h2>üîç Two Types of Validation</h2>
                
                <h3>1. Client-Side Validation (Browser)</h3>
                <p>Happens in the user's browser using HTML5 attributes or JavaScript. It's fast and provides instant feedback, but <span class="highlight">can be bypassed</span>!</p>
                
                <h3>2. Server-Side Validation (Express.js) ‚≠ê</h3>
                <p>Happens on your Node.js server. This is <strong>mandatory</strong> and the most important because:</p>
                <ul>
                    <li>Users can disable JavaScript</li>
                    <li>Attackers can send requests directly to your API</li>
                    <li>It's your last line of defense</li>
                </ul>
                
                <div class="warning">
                    <strong>‚ö†Ô∏è Golden Rule:</strong> Never trust client-side validation alone! Always validate on the server.
                </div>
            </div>
            
            <!-- Validation Methods -->
            <div class="section">
                <h2>üõ†Ô∏è Validation Methods in Express</h2>
                
                <div class="tabs">
                    <button class="tab active" onclick="showTab('manual')">Manual Validation</button>
                    <button class="tab" onclick="showTab('validator')">express-validator</button>
                    <button class="tab" onclick="showTab('joi')">Joi Validation</button>
                </div>
                
                <!-- Manual Validation -->
                <div id="manual" class="tab-content active">
                    <h3>Method 1: Manual Validation (Basic Approach)</h3>
                    <p>Writing your own validation logic using JavaScript. Good for learning and simple cases.</p>
                    
                    <div class="code-label">server.js - Setup</div>
<pre>
const express = require('express');
const app = express();

// Middleware to parse form data
app.use(express.urlencoded({ extended: true }));
app.use(express.json());

// Set EJS as template engine
app.set('view engine', 'ejs');
</pre>

                    <div class="code-label">routes/registration.js</div>
<pre>
// Registration form route
app.get('/register', (req, res) => {
    res.render('register', { errors: {}, formData: {} });
});

// Manual validation function
function validateRegistration(data) {
    const errors = {};
    
    // Name validation
    if (!data.name || data.name.trim() === '') {
        errors.name = 'Name is required';
    } else if (data.name.length < 3) {
        errors.name = 'Name must be at least 3 characters';
    }
    
    // Email validation
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!data.email) {
        errors.email = 'Email is required';
    } else if (!emailRegex.test(data.email)) {
        errors.email = 'Please enter a valid email';
    }
    
    // Phone validation (Indian mobile)
    const phoneRegex = /^[6-9]\d{9}$/;
    if (!data.phone) {
        errors.phone = 'Phone number is required';
    } else if (!phoneRegex.test(data.phone)) {
        errors.phone = 'Enter valid 10-digit mobile number';
    }
    
    // Age validation
    const age = parseInt(data.age);
    if (!data.age) {
        errors.age = 'Age is required';
    } else if (isNaN(age) || age < 18 || age > 100) {
        errors.age = 'Age must be between 18 and 100';
    }
    
    // City validation
    const validCities = ['Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Kolkata'];
    if (!data.city) {
        errors.city = 'Please select a city';
    } else if (!validCities.includes(data.city)) {
        errors.city = 'Invalid city selected';
    }
    
    return errors;
}

// Handle form submission
app.post('/register', (req, res) => {
    const errors = validateRegistration(req.body);
    
    if (Object.keys(errors).length > 0) {
        // Validation failed - send back to form with errors
        return res.render('register', { 
            errors: errors, 
            formData: req.body 
        });
    }
    
    // Validation passed - process the registration
    console.log('Valid registration:', req.body);
    res.send('Registration successful for ' + req.body.name);
});
</pre>

                    <div class="code-label">views/register.ejs</div>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Registration Form&lt;/title&gt;
    &lt;style&gt;
        .error { color: red; font-size: 0.9em; }
        input.error { border: 2px solid red; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;h2&gt;Student Registration&lt;/h2&gt;
    &lt;form method="POST" action="/register"&gt;
        &lt;div&gt;
            &lt;label&gt;Name:&lt;/label&gt;
            &lt;input type="text" name="name" 
                   value="&lt;%= formData.name || '' %&gt;"
                   class="&lt;%= errors.name ? 'error' : '' %&gt;"&gt;
            &lt;% if (errors.name) { %&gt;
                &lt;span class="error"&gt;&lt;%= errors.name %&gt;&lt;/span&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;div&gt;
            &lt;label&gt;Email:&lt;/label&gt;
            &lt;input type="text" name="email" 
                   value="&lt;%= formData.email || '' %&gt;"
                   class="&lt;%= errors.email ? 'error' : '' %&gt;"&gt;
            &lt;% if (errors.email) { %&gt;
                &lt;span class="error"&gt;&lt;%= errors.email %&gt;&lt;/span&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;div&gt;
            &lt;label&gt;Phone:&lt;/label&gt;
            &lt;input type="text" name="phone" 
                   value="&lt;%= formData.phone || '' %&gt;"
                   class="&lt;%= errors.phone ? 'error' : '' %&gt;"&gt;
            &lt;% if (errors.phone) { %&gt;
                &lt;span class="error"&gt;&lt;%= errors.phone %&gt;&lt;/span&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;div&gt;
            &lt;label&gt;Age:&lt;/label&gt;
            &lt;input type="number" name="age" 
                   value="&lt;%= formData.age || '' %&gt;"
                   class="&lt;%= errors.age ? 'error' : '' %&gt;"&gt;
            &lt;% if (errors.age) { %&gt;
                &lt;span class="error"&gt;&lt;%= errors.age %&gt;&lt;/span&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;div&gt;
            &lt;label&gt;City:&lt;/label&gt;
            &lt;select name="city" class="&lt;%= errors.city ? 'error' : '' %&gt;"&gt;
                &lt;option value=""&gt;Select City&lt;/option&gt;
                &lt;option value="Mumbai"&gt;Mumbai&lt;/option&gt;
                &lt;option value="Delhi"&gt;Delhi&lt;/option&gt;
                &lt;option value="Bangalore"&gt;Bangalore&lt;/option&gt;
                &lt;option value="Chennai"&gt;Chennai&lt;/option&gt;
                &lt;option value="Kolkata"&gt;Kolkata&lt;/option&gt;
            &lt;/select&gt;
            &lt;% if (errors.city) { %&gt;
                &lt;span class="error"&gt;&lt;%= errors.city %&gt;&lt;/span&gt;
            &lt;% } %&gt;
        &lt;/div&gt;
        
        &lt;button type="submit"&gt;Register&lt;/button&gt;
    &lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
                </div>
                
                <!-- express-validator -->
                <div id="validator" class="tab-content">
                    <h3>Method 2: express-validator (Recommended!) ‚≠ê</h3>
                    <p>A popular middleware that makes validation cleaner and more powerful. It's like having a professional security team instead of doing it yourself!</p>
                    
                    <div class="key-point">
                        <strong>üì¶ Installation:</strong>
                        <pre style="background: #1e293b; margin-top: 10px;">npm install express-validator</pre>
                    </div>
                    
                    <div class="code-label">server.js - With express-validator</div>
<pre>
const express = require('express');
const { body, validationResult } = require('express-validator');
const app = express();

app.use(express.urlencoded({ extended: true }));
app.set('view engine', 'ejs');

// Registration form
app.get('/register', (req, res) => {
    res.render('register', { errors: [], formData: {} });
});

// Validation middleware array
const registrationValidation = [
    body('name')
        .trim()
        .notEmpty().withMessage('Name is required')
        .isLength({ min: 3 }).withMessage('Name must be at least 3 characters')
        .matches(/^[a-zA-Z\s]+$/).withMessage('Name can only contain letters'),
    
    body('email')
        .trim()
        .notEmpty().withMessage('Email is required')
        .isEmail().withMessage('Please enter a valid email')
        .normalizeEmail(),
    
    body('phone')
        .trim()
        .notEmpty().withMessage('Phone number is required')
        .matches(/^[6-9]\d{9}$/).withMessage('Enter valid 10-digit Indian mobile'),
    
    body('age')
        .notEmpty().withMessage('Age is required')
        .isInt({ min: 18, max: 100 }).withMessage('Age must be between 18-100'),
    
    body('city')
        .notEmpty().withMessage('Please select a city')
        .isIn(['Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Kolkata'])
        .withMessage('Invalid city selected'),
    
    body('password')
        .notEmpty().withMessage('Password is required')
        .isLength({ min: 8 }).withMessage('Password must be at least 8 characters')
        .matches(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
        .withMessage('Password must contain uppercase, lowercase, and number')
];

// Handle registration with validation
app.post('/register', registrationValidation, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        // Format errors for EJS template
        const formattedErrors = {};
        errors.array().forEach(error => {
            formattedErrors[error.path] = error.msg;
        });
        
        return res.render('register', {
            errors: formattedErrors,
            formData: req.body
        });
    }
    
    // Success! Data is validated
    console.log('Valid registration:', req.body);
    res.send(`Welcome ${req.body.name}! Registration successful.`);
});

app.listen(3000, () => {
    console.log('Server running on http://localhost:3000');
});
</pre>

                    <div class="analogy">
                        <strong>üéØ express-validator Analogy:</strong>
                        Think of it as a factory assembly line. Each validation is a checkpoint:
                        <ul>
                            <li><code>.trim()</code> - Remove extra spaces (like cleaning the product)</li>
                            <li><code>.notEmpty()</code> - Ensure it exists (quality check)</li>
                            <li><code>.isEmail()</code> - Check format (specification check)</li>
                            <li><code>.normalizeEmail()</code> - Standardize format (packaging)</li>
                        </ul>
                        The data passes through each checkpoint before being approved!
                    </div>

                    <h3>Common Validation Methods:</h3>
                    <div class="demo-box">
                        <ul>
                            <li><code>.notEmpty()</code> - Field must not be empty</li>
                            <li><code>.isEmail()</code> - Must be valid email format</li>
                            <li><code>.isLength({min, max})</code> - String length constraints</li>
                            <li><code>.isInt({min, max})</code> - Integer with range</li>
                            <li><code>.isAlpha()</code> - Only alphabetic characters</li>
                            <li><code>.isAlphanumeric()</code> - Letters and numbers only</li>
                            <li><code>.matches(regex)</code> - Custom regex pattern</li>
                            <li><code>.isIn(array)</code> - Value must be in given array</li>
                            <li><code>.isURL()</code> - Valid URL format</li>
                            <li><code>.isDate()</code> - Valid date format</li>
                        </ul>
                    </div>
                </div>
                
                <!-- Joi Validation -->
                <div id="joi" class="tab-content">
                    <h3>Method 3: Joi Validation (Schema-Based)</h3>
                    <p>Joi allows you to define a schema for your data. It's like creating a blueprint that all data must match!</p>
                    
                    <div class="key-point">
                        <strong>üì¶ Installation:</strong>
                        <pre style="background: #1e293b; margin-top: 10px;">npm install joi</pre>
                    </div>
                    
                    <div class="code-label">server.js - With Joi</div>
<pre>
const express = require('express');
const Joi = require('joi');
const app = express();

app.use(express.urlencoded({ extended: true }));
app.set('view engine', 'ejs');

// Define validation schema
const registrationSchema = Joi.object({
    name: Joi.string()
        .min(3)
        .max(50)
        .pattern(/^[a-zA-Z\s]+$/)
        .required()
        .messages({
            'string.empty': 'Name is required',
            'string.min': 'Name must be at least 3 characters',
            'string.pattern.base': 'Name can only contain letters'
        }),
    
    email: Joi.string()
        .email()
        .required()
        .messages({
            'string.empty': 'Email is required',
            'string.email': 'Please enter a valid email'
        }),
    
    phone: Joi.string()
        .pattern(/^[6-9]\d{9}$/)
        .required()
        .messages({
            'string.empty': 'Phone number is required',
            'string.pattern.base': 'Enter valid 10-digit Indian mobile'
        }),
    
    age: Joi.number()
        .integer()
        .min(18)
        .max(100)
        .required()
        .messages({
            'number.base': 'Age must be a number',
            'number.min': 'You must be at least 18 years old',
            'number.max': 'Age cannot exceed 100'
        }),
    
    city: Joi.string()
        .valid('Mumbai', 'Delhi', 'Bangalore', 'Chennai', 'Kolkata')
        .required()
        .messages({
            'any.only': 'Please select a valid city',
            'string.empty': 'City is required'
        }),
    
    password: Joi.string()
        .min(8)
        .pattern(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/)
        .required()
        .messages({
            'string.min': 'Password must be at least 8 characters',
            'string.pattern.base': 'Password must contain uppercase, lowercase, and number'
        })
});

// Registration routes
app.get('/register', (req, res) => {
    res.render('register', { errors: {}, formData: {} });
});

app.post('/register', (req, res) => {
    // Validate against schema
    const { error, value } = registrationSchema.validate(req.body, {
        abortEarly: false // Get all errors, not just the first
    });
    
    if (error) {
        // Format errors for template
        const formattedErrors = {};
        error.details.forEach(detail => {
            formattedErrors[detail.path[0]] = detail.message;
        });
        
        return res.render('register', {
            errors: formattedErrors,
            formData: req.body
        });
    }
    
    // Data is valid!
    console.log('Valid data:', value);
    res.send(`Welcome ${value.name}! Registration successful.`);
});

app.listen(3000, () => console.log('Server on port 3000'));
</pre>

                    <div class="analogy">
                        <strong>üéØ Joi Schema Analogy:</strong>
                        Think of a Joi schema as a form template at a government office. Every applicant must fill the form following exact specifications:
                        <ul>
                            <li>Name box: Only letters, 3-50 characters</li>
                            <li>Age box: Only numbers, 18-100 range</li>
                            <li>City dropdown: Must select from given list</li>
                        </ul>
                        If anything doesn't match, the form is rejected with specific reasons!
                    </div>
                </div>
            </div>
            
            <!-- Custom Validators -->
            <div class="section">
                <h2>üé® Custom Validation Examples</h2>
                
                <h3>1. Custom Validator for PAN Card (Indian)</h3>
<pre>
// PAN format: ABCDE1234F
const { body } = require('express-validator');

body('panCard')
    .matches(/^[A-Z]{5}[0-9]{4}[A-Z]$/)
    .withMessage('Invalid PAN format (e.g., ABCDE1234F)')
    .custom((value) => {
        // Additional custom logic
        const fourthChar = value[3];
        if (fourthChar !== 'P') {
            throw new Error('Fourth character must be P for individual');
        }
        return true;
    })
</pre>

                <h3>2. Custom Validator for Password Confirmation</h3>
<pre>
body('password')
    .isLength({ min: 8 })
    .withMessage('Password must be at least 8 characters'),

body('confirmPassword')
    .custom((value, { req }) => {
        if (value !== req.body.password) {
            throw new Error('Passwords do not match');
        }
        return true;
    })
</pre>

                <h3>3. Async Validator - Check if Email Exists</h3>
<pre>
body('email')
    .isEmail()
    .custom(async (value) => {
        // Simulate database check
        const existingUser = await User.findOne({ email: value });
        if (existingUser) {
            throw new Error('Email already registered');
        }
        return true;
    })
</pre>

                <h3>4. Indian Aadhaar Number Validation</h3>
<pre>
body('aadhaar')
    .matches(/^[2-9]{1}[0-9]{11}$/)
    .withMessage('Aadhaar must be 12 digits and cannot start with 0 or 1')
    .custom((value) => {
        // Verhoeff algorithm for Aadhaar checksum
        // (Simplified example)
        const digits = value.split('').map(Number);
        // Checksum validation logic here
        return true;
    })
</pre>
            </div>
            
            <!-- Sanitization -->
            <div class="section">
                <h2>üßπ Sanitization - Cleaning User Input</h2>
                <p>Sanitization is cleaning and standardizing data before validation. It's like washing vegetables before cooking!</p>
                
                <div class="demo-box">
                    <h3>Common Sanitization Methods:</h3>
<pre>
const { body } = require('express-validator');

// Sanitization chain
body('name')
    .trim()                    // Remove whitespace from both ends
    .escape()                  // Escape HTML characters
    .toLowerCase()             // Convert to lowercase
    .whitelist('a-zA-Z ')      // Allow only these characters

body('email')
    .trim()
    .normalizeEmail()          // Standardize email format

body('phone')
    .trim()
    .blacklist('-() ')         // Remove these characters

body('bio')
    .trim()
    .stripLow()                // Remove control characters
</pre>
                </div>
                
                <div class="analogy">
                    <strong>üéØ Sanitization Analogy:</strong>
                    Imagine receiving vegetables from a vendor:
                    <ul>
                        <li><code>.trim()</code> - Remove outer leaves/dirt</li>
                        <li><code>.escape()</code> - Remove harmful pesticides</li>
                        <li><code>.normalizeEmail()</code> - Standardize cutting style</li>
                    </ul>
                    After sanitization, vegetables are clean and ready for cooking (validation)!
                </div>
            </div>
            
            <!-- Error Handling Patterns -->
            <div class="section">
                <h2>üîß Error Handling Patterns</h2>
                
                <h3>Pattern 1: Display All Errors Together</h3>
<pre>
app.post('/register', validationMiddleware, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        return res.render('register', {
            errors: errors.array(),  // Array of all errors
            formData: req.body
        });
    }
    // Process form...
});
</pre>

                <h3>Pattern 2: Field-Specific Errors (Better UX)</h3>
<pre>
app.post('/register', validationMiddleware, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        const errorObj = {};
        errors.array().forEach(error => {
            errorObj[error.path] = error.msg;
        });
        
        return res.render('register', {
            errors: errorObj,
            formData: req.body
        });
    }
    // Process form...
});
</pre>

                <h3>Pattern 3: Flash Messages (with express-session)</h3>
<pre>
const session = require('express-session');
const flash = require('connect-flash');

app.use(session({
    secret: 'your-secret-key',
    resave: false,
    saveUninitialized: true
}));
app.use(flash());

app.post('/register', validationMiddleware, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        errors.array().forEach(error => {
            req.flash('error', error.msg);
        });
        return res.redirect('/register');
    }
    
    req.flash('success', 'Registration successful!');
    res.redirect('/dashboard');
});
</pre>

                <h3>Pattern 4: JSON API Response</h3>
<pre>
// For REST API endpoints
app.post('/api/register', validationMiddleware, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        return res.status(400).json({
            success: false,
            errors: errors.array()
        });
    }
    
    // Process registration
    res.json({
        success: true,
        message: 'Registration successful',
        data: { userId: 123 }
    });
});
</pre>
            </div>
            
            <!-- Real-World Example -->
            <div class="section">
                <h2>üéì Complete Real-World Example: Student Registration</h2>
                <p>Let's build a complete student registration system with multiple validation scenarios!</p>
                
                <div class="code-label">models/Student.js - Simulated Database</div>
<pre>
// In-memory database (use MongoDB/MySQL in production)
const students = [];

class Student {
    static async findByEmail(email) {
        return students.find(s => s.email === email);
    }
    
    static async findByRollNumber(rollNo) {
        return students.find(s => s.rollNumber === rollNo);
    }
    
    static async create(data) {
        const student = {
            id: students.length + 1,
            ...data,
            createdAt: new Date()
        };
        students.push(student);
        return student;
    }
    
    static getAll() {
        return students;
    }
}

module.exports = Student;
</pre>

                <div class="code-label">validators/studentValidator.js</div>
<pre>
const { body } = require('express-validator');
const Student = require('../models/Student');

const studentValidation = [
    // Name validation
    body('name')
        .trim()
        .notEmpty().withMessage('Name is required')
        .isLength({ min: 3, max: 50 })
        .withMessage('Name must be between 3-50 characters')
        .matches(/^[a-zA-Z\s]+$/)
        .withMessage('Name can only contain letters and spaces'),
    
    // Email validation with uniqueness check
    body('email')
        .trim()
        .notEmpty().withMessage('Email is required')
        .isEmail().withMessage('Please enter a valid email')
        .normalizeEmail()
        .custom(async (value) => {
            const existingStudent = await Student.findByEmail(value);
            if (existingStudent) {
                throw new Error('Email already registered');
            }
            return true;
        }),
    
    // Roll Number validation
    body('rollNumber')
        .trim()
        .notEmpty().withMessage('Roll number is required')
        .matches(/^[A-Z]{2}\d{6}$/)
        .withMessage('Roll number must be in format: AB123456')
        .custom(async (value) => {
            const existing = await Student.findByRollNumber(value);
            if (existing) {
                throw new Error('Roll number already exists');
            }
            return true;
        }),
    
    // Phone validation (Indian)
    body('phone')
        .trim()
        .notEmpty().withMessage('Phone number is required')
        .matches(/^[6-9]\d{9}$/)
        .withMessage('Enter valid 10-digit Indian mobile number starting with 6-9'),
    
    // Date of Birth validation
    body('dob')
        .notEmpty().withMessage('Date of birth is required')
        .isDate().withMessage('Please enter a valid date')
        .custom((value) => {
            const dob = new Date(value);
            const today = new Date();
            const age = today.getFullYear() - dob.getFullYear();
            
            if (age < 16 || age > 30) {
                throw new Error('Age must be between 16 and 30 years');
            }
            return true;
        }),
    
    // Gender validation
    body('gender')
        .notEmpty().withMessage('Gender is required')
        .isIn(['Male', 'Female', 'Other'])
        .withMessage('Please select a valid gender'),
    
    // Course validation
    body('course')
        .notEmpty().withMessage('Course is required')
        .isIn(['BTech', 'MTech', 'MBA', 'BCA', 'MCA'])
        .withMessage('Please select a valid course'),
    
    // Branch validation (conditional)
    body('branch')
        .if(body('course').isIn(['BTech', 'MTech']))
        .notEmpty().withMessage('Branch is required for BTech/MTech')
        .isIn(['CSE', 'ECE', 'Mechanical', 'Civil', 'Electrical'])
        .withMessage('Please select a valid branch'),
    
    // CGPA validation
    body('cgpa')
        .optional()
        .isFloat({ min: 0, max: 10 })
        .withMessage('CGPA must be between 0 and 10'),
    
    // Address validation
    body('address')
        .trim()
        .notEmpty().withMessage('Address is required')
        .isLength({ min: 10, max: 200 })
        .withMessage('Address must be between 10-200 characters'),
    
    // City validation
    body('city')
        .trim()
        .notEmpty().withMessage('City is required')
        .isLength({ min: 2 }).withMessage('City name too short'),
    
    // State validation
    body('state')
        .notEmpty().withMessage('State is required')
        .isIn([
            'Andhra Pradesh', 'Telangana', 'Karnataka', 'Tamil Nadu',
            'Kerala', 'Maharashtra', 'Gujarat', 'Delhi', 'West Bengal'
        ]).withMessage('Please select a valid state'),
    
    // Pincode validation (Indian)
    body('pincode')
        .trim()
        .notEmpty().withMessage('Pincode is required')
        .matches(/^[1-9][0-9]{5}$/)
        .withMessage('Enter valid 6-digit Indian pincode'),
    
    // Guardian name validation
    body('guardianName')
        .trim()
        .notEmpty().withMessage('Guardian name is required')
        .isLength({ min: 3 }).withMessage('Guardian name too short'),
    
    // Guardian phone validation
    body('guardianPhone')
        .trim()
        .notEmpty().withMessage('Guardian phone is required')
        .matches(/^[6-9]\d{9}$/)
        .withMessage('Enter valid guardian mobile number')
];

module.exports = { studentValidation };
</pre>

                <div class="code-label">routes/studentRoutes.js</div>
<pre>
const express = require('express');
const router = express.Router();
const { validationResult } = require('express-validator');
const { studentValidation } = require('../validators/studentValidator');
const Student = require('../models/Student');

// Display registration form
router.get('/register', (req, res) => {
    res.render('student-register', {
        errors: {},
        formData: {},
        success: false
    });
});

// Handle registration submission
router.post('/register', studentValidation, async (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        // Format errors for template
        const formattedErrors = {};
        errors.array().forEach(error => {
            formattedErrors[error.path] = error.msg;
        });
        
        return res.render('student-register', {
            errors: formattedErrors,
            formData: req.body,
            success: false
        });
    }
    
    try {
        // Save student to database
        const student = await Student.create(req.body);
        
        // Success! Redirect or show success message
        res.render('student-register', {
            errors: {},
            formData: {},
            success: true,
            studentName: student.name,
            rollNumber: student.rollNumber
        });
        
    } catch (error) {
        console.error('Registration error:', error);
        res.render('student-register', {
            errors: { general: 'Registration failed. Please try again.' },
            formData: req.body,
            success: false
        });
    }
});

// View all students
router.get('/students', (req, res) => {
    const students = Student.getAll();
    res.render('student-list', { students });
});

module.exports = router;
</pre>

                <div class="code-label">views/student-register.ejs</div>
<pre>
&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Student Registration&lt;/title&gt;
    &lt;style&gt;
        * { box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #2d3748;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: 600;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        input.error, select.error, textarea.error {
            border-color: #ef4444;
        }
        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: 5px;
            display: block;
        }
        .success-message {
            background: #d1fae5;
            border: 2px solid #10b981;
            color: #065f46;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        button {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #5a67d8;
        }
        .required { color: #ef4444; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="container"&gt;
        &lt;h1&gt;üéì Student Registration Form&lt;/h1&gt;
        
        &lt;% if (success) { %&gt;
            &lt;div class="success-message"&gt;
                &lt;h3&gt;‚úÖ Registration Successful!&lt;/h3&gt;
                &lt;p&gt;Welcome &lt;strong&gt;&lt;%= studentName %&gt;&lt;/strong&gt;!&lt;/p&gt;
                &lt;p&gt;Your Roll Number: &lt;strong&gt;&lt;%= rollNumber %&gt;&lt;/strong&gt;&lt;/p&gt;
            &lt;/div&gt;
        &lt;% } %&gt;
        
        &lt;form method="POST" action="/register"&gt;
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Full Name &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="text" name="name" 
                           value="&lt;%= formData.name || '' %&gt;"
                           class="&lt;%= errors.name ? 'error' : '' %&gt;"
                           placeholder="e.g., Rahul Sharma"&gt;
                    &lt;% if (errors.name) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.name %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Roll Number &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="text" name="rollNumber" 
                           value="&lt;%= formData.rollNumber || '' %&gt;"
                           class="&lt;%= errors.rollNumber ? 'error' : '' %&gt;"
                           placeholder="e.g., CS123456"&gt;
                    &lt;% if (errors.rollNumber) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.rollNumber %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Email &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="email" name="email" 
                           value="&lt;%= formData.email || '' %&gt;"
                           class="&lt;%= errors.email ? 'error' : '' %&gt;"
                           placeholder="rahul.sharma@email.com"&gt;
                    &lt;% if (errors.email) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.email %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Phone Number &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="tel" name="phone" 
                           value="&lt;%= formData.phone || '' %&gt;"
                           class="&lt;%= errors.phone ? 'error' : '' %&gt;"
                           placeholder="9876543210"&gt;
                    &lt;% if (errors.phone) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.phone %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Date of Birth &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="date" name="dob" 
                           value="&lt;%= formData.dob || '' %&gt;"
                           class="&lt;%= errors.dob ? 'error' : '' %&gt;"&gt;
                    &lt;% if (errors.dob) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.dob %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Gender &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;select name="gender" class="&lt;%= errors.gender ? 'error' : '' %&gt;"&gt;
                        &lt;option value=""&gt;Select Gender&lt;/option&gt;
                        &lt;option value="Male" &lt;%= formData.gender === 'Male' ? 'selected' : '' %&gt;&gt;Male&lt;/option&gt;
                        &lt;option value="Female" &lt;%= formData.gender === 'Female' ? 'selected' : '' %&gt;&gt;Female&lt;/option&gt;
                        &lt;option value="Other" &lt;%= formData.gender === 'Other' ? 'selected' : '' %&gt;&gt;Other&lt;/option&gt;
                    &lt;/select&gt;
                    &lt;% if (errors.gender) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.gender %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Course &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;select name="course" class="&lt;%= errors.course ? 'error' : '' %&gt;"&gt;
                        &lt;option value=""&gt;Select Course&lt;/option&gt;
                        &lt;option value="BTech"&gt;BTech&lt;/option&gt;
                        &lt;option value="MTech"&gt;MTech&lt;/option&gt;
                        &lt;option value="MBA"&gt;MBA&lt;/option&gt;
                        &lt;option value="BCA"&gt;BCA&lt;/option&gt;
                        &lt;option value="MCA"&gt;MCA&lt;/option&gt;
                    &lt;/select&gt;
                    &lt;% if (errors.course) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.course %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Branch&lt;/label&gt;
                    &lt;select name="branch" class="&lt;%= errors.branch ? 'error' : '' %&gt;"&gt;
                        &lt;option value=""&gt;Select Branch&lt;/option&gt;
                        &lt;option value="CSE"&gt;Computer Science&lt;/option&gt;
                        &lt;option value="ECE"&gt;Electronics&lt;/option&gt;
                        &lt;option value="Mechanical"&gt;Mechanical&lt;/option&gt;
                        &lt;option value="Civil"&gt;Civil&lt;/option&gt;
                        &lt;option value="Electrical"&gt;Electrical&lt;/option&gt;
                    &lt;/select&gt;
                    &lt;% if (errors.branch) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.branch %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="form-group"&gt;
                &lt;label&gt;Address &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                &lt;textarea name="address" rows="3" 
                          class="&lt;%= errors.address ? 'error' : '' %&gt;"
                          placeholder="Enter your complete address"&gt;&lt;%= formData.address || '' %&gt;&lt;/textarea&gt;
                &lt;% if (errors.address) { %&gt;
                    &lt;span class="error-message"&gt;&lt;%= errors.address %&gt;&lt;/span&gt;
                &lt;% } %&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;City &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="text" name="city" 
                           value="&lt;%= formData.city || '' %&gt;"
                           class="&lt;%= errors.city ? 'error' : '' %&gt;"
                           placeholder="e.g., Hyderabad"&gt;
                    &lt;% if (errors.city) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.city %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;State &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;select name="state" class="&lt;%= errors.state ? 'error' : '' %&gt;"&gt;
                        &lt;option value=""&gt;Select State&lt;/option&gt;
                        &lt;option value="Andhra Pradesh"&gt;Andhra Pradesh&lt;/option&gt;
                        &lt;option value="Telangana"&gt;Telangana&lt;/option&gt;
                        &lt;option value="Karnataka"&gt;Karnataka&lt;/option&gt;
                        &lt;option value="Tamil Nadu"&gt;Tamil Nadu&lt;/option&gt;
                        &lt;option value="Kerala"&gt;Kerala&lt;/option&gt;
                        &lt;option value="Maharashtra"&gt;Maharashtra&lt;/option&gt;
                    &lt;/select&gt;
                    &lt;% if (errors.state) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.state %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Pincode &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="text" name="pincode" 
                           value="&lt;%= formData.pincode || '' %&gt;"
                           class="&lt;%= errors.pincode ? 'error' : '' %&gt;"
                           placeholder="500001"&gt;
                    &lt;% if (errors.pincode) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.pincode %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;CGPA (if applicable)&lt;/label&gt;
                    &lt;input type="number" name="cgpa" step="0.01"
                           value="&lt;%= formData.cgpa || '' %&gt;"
                           class="&lt;%= errors.cgpa ? 'error' : '' %&gt;"
                           placeholder="8.5"&gt;
                    &lt;% if (errors.cgpa) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.cgpa %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div class="row"&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Guardian Name &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="text" name="guardianName" 
                           value="&lt;%= formData.guardianName || '' %&gt;"
                           class="&lt;%= errors.guardianName ? 'error' : '' %&gt;"
                           placeholder="e.g., Ramesh Sharma"&gt;
                    &lt;% if (errors.guardianName) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.guardianName %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
                
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Guardian Phone &lt;span class="required"&gt;*&lt;/span&gt;&lt;/label&gt;
                    &lt;input type="tel" name="guardianPhone" 
                           value="&lt;%= formData.guardianPhone || '' %&gt;"
                           class="&lt;%= errors.guardianPhone ? 'error' : '' %&gt;"
                           placeholder="9876543210"&gt;
                    &lt;% if (errors.guardianPhone) { %&gt;
                        &lt;span class="error-message"&gt;&lt;%= errors.guardianPhone %&gt;&lt;/span&gt;
                    &lt;% } %&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;button type="submit"&gt;Register Student&lt;/button&gt;
        &lt;/form&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre>
            </div>
            
            <!-- Best Practices -->
            <div class="section">
                <h2>‚úÖ Best Practices for Form Validation</h2>
                
                <ol>
                    <li>
                        <strong>Always validate on the server</strong> - Never trust client-side validation alone
                    </li>
                    <li>
                        <strong>Sanitize before validating</strong> - Use .trim(), .escape(), etc.
                    </li>
                    <li>
                        <strong>Provide clear error messages</strong> - Tell users exactly what's wrong
                        <pre>‚ùå Bad: "Invalid input"
‚úÖ Good: "Email must be in format: name@example.com"</pre>
                    </li>
                    <li>
                        <strong>Preserve user input</strong> - Don't make users re-enter everything
                    </li>
                    <li>
                        <strong>Use regex carefully</strong> - Test your patterns thoroughly
                    </li>
                    <li>
                        <strong>Validate data types</strong> - Ensure numbers are numbers, dates are dates
                    </li>
                    <li>
                        <strong>Check for SQL injection</strong> - Use parameterized queries
                    </li>
                    <li>
                        <strong>Limit input length</strong> - Prevent buffer overflow attacks
                    </li>
                    <li>
                        <strong>Use HTTPS</strong> - Always transmit sensitive data securely
                    </li>
                    <li>
                        <strong>Log validation failures</strong> - Monitor for potential attacks
                    </li>
                </ol>
            </div>
            
            <!-- Common Pitfalls -->
            <div class="section">
                <h2>‚ö†Ô∏è Common Pitfalls to Avoid</h2>
                
                <div class="warning">
                    <h3>1. Forgetting Async Validators</h3>
<pre>
// ‚ùå Wrong - Not handling async properly
body('email').custom((value) => {
    User.findOne({ email: value });  // Returns promise!
    return true;  // Always returns true
});

// ‚úÖ Correct - Properly handling async
body('email').custom(async (value) => {
    const user = await User.findOne({ email: value });
    if (user) throw new Error('Email exists');
    return true;
});
</pre>
                </div>
                
                <div class="warning">
                    <h3>2. Not Checking for Empty Strings After Trim</h3>
<pre>
// ‚ùå Wrong - Spaces pass validation
body('name').isLength({ min: 3 })

// ‚úÖ Correct - Trim first, then check
body('name').trim().notEmpty().isLength({ min: 3 })
</pre>
                </div>
                
                <div class="warning">
                    <h3>3. Exposing Sensitive Information in Errors</h3>
<pre>
// ‚ùå Wrong - Tells attacker email exists
if (existingUser) {
    throw new Error('User with email john@example.com already exists');
}

// ‚úÖ Correct - Generic message
if (existingUser) {
    throw new Error('Email already registered');
}
</pre>
                </div>
                
                <div class="warning">
                    <h3>4. Not Validating All Fields</h3>
<pre>
// ‚ùå Wrong - Hidden fields can be manipulated
&lt;input type="hidden" name="role" value="admin"&gt;

// ‚úÖ Correct - Validate hidden fields too
body('role').isIn(['user', 'moderator']).withMessage('Invalid role')
</pre>
                </div>
            </div>
            
            <!-- Testing -->
            <div class="section">
                <h2>üß™ Testing Your Validation</h2>
                <p>Always test your validation with various inputs to ensure it works correctly!</p>
                
                <h3>Test Cases You Should Try:</h3>
                
                <div class="demo-box">
                    <h4>1. Empty Field Tests</h4>
                    <ul>
                        <li>Submit form with all fields empty</li>
                        <li>Submit with only some fields filled</li>
                        <li>Submit with spaces only in required fields</li>
                    </ul>
                    
                    <h4>2. Format Tests</h4>
                    <ul>
                        <li><strong>Email:</strong> test@, @example.com, test@@example.com</li>
                        <li><strong>Phone:</strong> 12345, 123456789012, abcdefghij</li>
                        <li><strong>Date:</strong> 32/13/2024, 2030-01-01 (future)</li>
                    </ul>
                    
                    <h4>3. Boundary Tests</h4>
                    <ul>
                        <li>Minimum length - 1 (e.g., 2 chars when min is 3)</li>
                        <li>Exact minimum (e.g., 3 chars when min is 3)</li>
                        <li>Maximum length + 1</li>
                        <li>Age boundaries (17, 18, 100, 101)</li>
                    </ul>
                    
                    <h4>4. Security Tests</h4>
                    <ul>
                        <li><strong>SQL Injection:</strong> ' OR '1'='1</li>
                        <li><strong>XSS:</strong> &lt;script&gt;alert('XSS')&lt;/script&gt;</li>
                        <li><strong>HTML:</strong> &lt;h1&gt;Hello&lt;/h1&gt;</li>
                    </ul>
                    
                    <h4>5. Special Character Tests</h4>
                    <ul>
                        <li>Unicode characters: ‡§™‡•ç‡§∞‡§µ‡•Ä‡§£ ‡§ï‡•Å‡§Æ‡§æ‡§∞</li>
                        <li>Emojis: üòÄüéâ</li>
                        <li>Special symbols: @#$%^&*()</li>
                    </ul>
                </div>
                
                <div class="code-label">Example: Using Postman/cURL for API Testing</div>
<pre>
# Test with cURL (Command line)
curl -X POST http://localhost:3000/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "",
    "email": "invalid-email",
    "phone": "123",
    "age": "15"
  }'

# Expected Response:
{
  "errors": [
    { "field": "name", "message": "Name is required" },
    { "field": "email", "message": "Please enter a valid email" },
    { "field": "phone", "message": "Enter valid 10-digit mobile" },
    { "field": "age", "message": "Age must be between 18-100" }
  ]
}
</pre>
            </div>
            
            <!-- Advanced Topics -->
            <div class="section">
                <h2>üöÄ Advanced Validation Techniques</h2>
                
                <h3>1. Conditional Validation</h3>
                <p>Validate fields based on other field values:</p>
<pre>
body('branch')
    .if(body('course').equals('BTech'))
    .notEmpty().withMessage('Branch required for BTech students')
    .isIn(['CSE', 'ECE', 'Mechanical'])
    .withMessage('Invalid branch for BTech'),

body('experience')
    .if(body('jobStatus').equals('Employed'))
    .notEmpty().withMessage('Experience required for employed candidates')
    .isInt({ min: 0, max: 50 }).withMessage('Invalid experience years')
</pre>

                <h3>2. Cross-Field Validation</h3>
                <p>Validate relationships between multiple fields:</p>
<pre>
body('confirmPassword')
    .custom((value, { req }) => {
        if (value !== req.body.password) {
            throw new Error('Passwords do not match');
        }
        return true;
    }),

body('endDate')
    .custom((value, { req }) => {
        const start = new Date(req.body.startDate);
        const end = new Date(value);
        
        if (end <= start) {
            throw new Error('End date must be after start date');
        }
        return true;
    })
</pre>

                <h3>3. File Upload Validation</h3>
                <p>Validate uploaded files using multer and custom validators:</p>
<pre>
const multer = require('multer');

// Configure multer
const storage = multer.diskStorage({
    destination: 'uploads/',
    filename: (req, file, cb) => {
        const uniqueName = Date.now() + '-' + file.originalname;
        cb(null, uniqueName);
    }
});

const fileFilter = (req, file, cb) => {
    // Accept only images
    if (file.mimetype.startsWith('image/')) {
        cb(null, true);
    } else {
        cb(new Error('Only image files allowed!'), false);
    }
};

const upload = multer({
    storage: storage,
    fileFilter: fileFilter,
    limits: { fileSize: 5 * 1024 * 1024 } // 5MB max
});

// Route with file validation
app.post('/upload-profile', 
    upload.single('photo'),
    body('caption').trim().isLength({ max: 200 }),
    (req, res) => {
        const errors = validationResult(req);
        
        if (!req.file) {
            return res.status(400).json({
                error: 'Please upload a profile photo'
            });
        }
        
        if (!errors.isEmpty()) {
            return res.status(400).json({ errors: errors.array() });
        }
        
        res.json({
            message: 'Photo uploaded successfully',
            filename: req.file.filename
        });
    }
);
</pre>

                <h3>4. Array/Multiple Value Validation</h3>
                <p>Validate arrays of data:</p>
<pre>
// Validate array of subjects
body('subjects')
    .isArray({ min: 1, max: 6 })
    .withMessage('Select 1-6 subjects'),

body('subjects.*')
    .isIn(['Mathematics', 'Physics', 'Chemistry', 'Biology', 'English'])
    .withMessage('Invalid subject selected'),

// Validate each item in hobbies array
body('hobbies')
    .optional()
    .isArray()
    .withMessage('Hobbies must be an array'),

body('hobbies.*')
    .trim()
    .isLength({ min: 2, max: 30 })
    .withMessage('Each hobby must be 2-30 characters')
</pre>

                <h3>5. Rate Limiting Validation Requests</h3>
                <p>Prevent abuse by limiting validation attempts:</p>
<pre>
const rateLimit = require('express-rate-limit');

// Limit registration attempts
const registrationLimiter = rateLimit({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 5, // 5 requests per windowMs
    message: 'Too many registration attempts. Please try again later.',
    standardHeaders: true,
    legacyHeaders: false
});

// Apply to registration route
app.post('/register', 
    registrationLimiter,
    registrationValidation,
    (req, res) => {
        // Handle registration
    }
);
</pre>
            </div>
            
            <!-- Real-World Scenarios -->
            <div class="section">
                <h2>üåç Real-World Scenarios</h2>
                
                <h3>Scenario 1: E-commerce Product Form</h3>
<pre>
const productValidation = [
    body('productName')
        .trim()
        .notEmpty().withMessage('Product name required')
        .isLength({ min: 5, max: 100 }),
    
    body('price')
        .notEmpty().withMessage('Price required')
        .isFloat({ min: 1 }).withMessage('Price must be at least ‚Çπ1')
        .custom((value) => {
            // Indian Rupee validation
            const formatted = parseFloat(value).toFixed(2);
            if (formatted !== parseFloat(value).toString()) {
                throw new Error('Price can have max 2 decimal places');
            }
            return true;
        }),
    
    body('quantity')
        .isInt({ min: 1, max: 10000 })
        .withMessage('Quantity must be between 1-10,000'),
    
    body('category')
        .isIn(['Electronics', 'Clothing', 'Books', 'Home', 'Sports'])
        .withMessage('Invalid category'),
    
    body('gstNumber')
        .optional()
        .matches(/^\d{2}[A-Z]{5}\d{4}[A-Z]{1}[A-Z\d]{1}[Z]{1}[A-Z\d]{1}$/)
        .withMessage('Invalid GST number format')
];
</pre>

                <h3>Scenario 2: Job Application Form</h3>
<pre>
const jobApplicationValidation = [
    body('fullName')
        .trim()
        .notEmpty()
        .matches(/^[a-zA-Z\s]+$/)
        .isLength({ min: 3, max: 50 }),
    
    body('email')
        .trim()
        .isEmail()
        .normalizeEmail()
        .custom(async (value) => {
            const exists = await JobApplication.findOne({ email: value });
            if (exists) {
                throw new Error('You have already applied for this position');
            }
            return true;
        }),
    
    body('resume')
        .custom((value, { req }) => {
            if (!req.file) {
                throw new Error('Resume is required');
            }
            const allowedTypes = ['application/pdf'];
            if (!allowedTypes.includes(req.file.mimetype)) {
                throw new Error('Only PDF format allowed');
            }
            if (req.file.size > 2 * 1024 * 1024) {
                throw new Error('Resume size must be less than 2MB');
            }
            return true;
        }),
    
    body('experience')
        .isInt({ min: 0, max: 50 })
        .withMessage('Experience must be 0-50 years'),
    
    body('currentCTC')
        .optional()
        .isFloat({ min: 0 })
        .withMessage('Current CTC must be a valid amount'),
    
    body('expectedCTC')
        .isFloat({ min: 0 })
        .withMessage('Expected CTC required')
        .custom((value, { req }) => {
            if (req.body.currentCTC && value < req.body.currentCTC * 0.8) {
                throw new Error('Expected CTC too low compared to current');
            }
            return true;
        }),
    
    body('noticePeriod')
        .isIn(['Immediate', '15 Days', '30 Days', '60 Days', '90 Days'])
        .withMessage('Invalid notice period')
];
</pre>

                <h3>Scenario 3: Event Registration with Multiple Participants</h3>
<pre>
const eventRegistrationValidation = [
    body('eventName')
        .notEmpty().withMessage('Event name required'),
    
    body('participants')
        .isArray({ min: 1, max: 5 })
        .withMessage('Register 1-5 participants'),
    
    body('participants.*.name')
        .trim()
        .notEmpty().withMessage('Participant name required')
        .isLength({ min: 3 }),
    
    body('participants.*.email')
        .isEmail().withMessage('Valid email required')
        .normalizeEmail(),
    
    body('participants.*.phone')
        .matches(/^[6-9]\d{9}$/)
        .withMessage('Valid Indian mobile required'),
    
    body('participants.*.age')
        .isInt({ min: 18, max: 100 })
        .withMessage('Participant age must be 18-100'),
    
    body('paymentMethod')
        .isIn(['UPI', 'Card', 'NetBanking', 'Wallet'])
        .withMessage('Invalid payment method'),
    
    body('transactionId')
        .if(body('paymentMethod').not().equals('Cash'))
        .notEmpty().withMessage('Transaction ID required')
        .isLength({ min: 10, max: 50 })
];
</pre>
            </div>
            
            <!-- Debugging Tips -->
            <div class="section">
                <h2>üêõ Debugging Validation Issues</h2>
                
                <div class="key-point">
                    <h3>Common Debugging Techniques:</h3>
                    
                    <h4>1. Log the Validation Errors</h4>
<pre>
app.post('/register', validationMiddleware, (req, res) => {
    const errors = validationResult(req);
    
    if (!errors.isEmpty()) {
        console.log('Validation Errors:', JSON.stringify(errors.array(), null, 2));
        // Continue with error handling...
    }
});
</pre>

                    <h4>2. Log the Request Body</h4>
<pre>
app.post('/register', validationMiddleware, (req, res) => {
    console.log('Request Body:', req.body);
    console.log('Request Body Type:', typeof req.body);
    console.log('Specific Field:', req.body.email);
    
    // Continue with validation...
});
</pre>

                    <h4>3. Test Individual Validators</h4>
<pre>
// Create a test route to check one validator at a time
app.post('/test-email', 
    body('email').isEmail().withMessage('Invalid email'),
    (req, res) => {
        const errors = validationResult(req);
        res.json({
            hasErrors: !errors.isEmpty(),
            errors: errors.array(),
            receivedValue: req.body.email
        });
    }
);
</pre>

                    <h4>4. Check Middleware Order</h4>
<pre>
// ‚ùå Wrong order - body parser after validation
app.post('/register', validationMiddleware, (req, res) => {});
app.use(express.json());

// ‚úÖ Correct order - body parser before routes
app.use(express.json());
app.use(express.urlencoded({ extended: true }));
app.post('/register', validationMiddleware, (req, res) => {});
</pre>
                </div>
            </div>
            
            <!-- Summary -->
            <div class="section">
                <h2>üìù Summary & Key Takeaways</h2>
                
                <div class="demo-box">
                    <h3>‚úÖ What We Learned:</h3>
                    <ol>
                        <li><strong>Form validation is essential</strong> for security and data integrity</li>
                        <li><strong>Always validate on the server</strong> - client-side is just for UX</li>
                        <li><strong>express-validator is the recommended approach</strong> for Express apps</li>
                        <li><strong>Sanitize before validating</strong> to clean user input</li>
                        <li><strong>Provide clear error messages</strong> to help users correct issues</li>
                        <li><strong>Test thoroughly</strong> with various edge cases</li>
                        <li><strong>Use custom validators</strong> for complex business logic</li>
                        <li><strong>Handle async validations properly</strong> (database checks)</li>
                        <li><strong>Validate arrays and files</strong> when needed</li>
                        <li><strong>Implement rate limiting</strong> to prevent abuse</li>
                    </ol>
                    
                    <h3>üéØ Quick Reference Cheat Sheet:</h3>
<pre>
// Basic Setup
npm install express express-validator

// Common Validators
.notEmpty()              - Field must not be empty
.isEmail()              - Valid email format
.isLength({min, max})   - String length
.isInt({min, max})      - Integer range
.isFloat({min, max})    - Decimal number
.isIn([array])          - Value in array
.matches(/regex/)       - Custom pattern
.custom(fn)             - Custom logic

// Common Sanitizers
.trim()                 - Remove whitespace
.escape()               - Escape HTML
.normalizeEmail()       - Standardize email
.toInt()               - Convert to integer
.toLowerCase()          - Convert to lowercase

// Validation Pattern
const validate = [
    body('field').trim().notEmpty().isLength({min: 3})
];

app.post('/route', validate, (req, res) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
        return res.render('form', { errors: errors.array() });
    }
    // Process valid data
});
</pre>
                </div>
                
                <div class="analogy">
                    <strong>üéì Final Analogy:</strong>
                    Think of form validation as a quality control department in a factory:
                    <ul>
                        <li><strong>Sanitization</strong> - Cleaning raw materials</li>
                        <li><strong>Validation</strong> - Quality inspection</li>
                        <li><strong>Error Messages</strong> - Rejection notes</li>
                        <li><strong>Success</strong> - Approved for production</li>
                    </ul>
                    Just as a factory can't produce quality products without QC, your app can't maintain data integrity without proper validation!
                </div>
            </div>
            
            <!-- Resources -->
            <div class="section">
                <h2>üìö Additional Resources</h2>
                <ul>
                    <li><strong>express-validator Documentation:</strong> https://express-validator.github.io/</li>
                    <li><strong>Joi Documentation:</strong> https://joi.dev/</li>
                    <li><strong>RegEx Testing:</strong> https://regex101.com/</li>
                    <li><strong>Indian Validation Patterns:</strong>
                        <ul>
                            <li>Mobile: <code>/^[6-9]\d{9}$/</code></li>
                            <li>PAN: <code>/^[A-Z]{5}[0-9]{4}[A-Z]$/</code></li>
                            <li>Aadhaar: <code>/^[2-9]{1}[0-9]{11}$/</code></li>
                            <li>Pincode: <code>/^[1-9][0-9]{5}$/</code></li>
                            <li>IFSC: <code>/^[A-Z]{4}0[A-Z0-9]{6}$/</code></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    
    <script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.remove('active'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }
    </script>
</body>
</html>